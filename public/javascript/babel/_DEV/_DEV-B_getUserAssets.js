var jsonExercises = [{"_id":"589f37a1251cc61588c4d951","name":"Bench Press","description":"Push a bar with your chest","creator":"589f3792251cc61588c4d950","__v":0,"category":"Chest","exerciseHistory":[{"date":"2017-02-11T16:16:55.821Z","_id":"589f38f7c1fbcb16052a694f","dataHistory":[{"weight":150,"repetitions":10,"oneRepMax":200,"exercise":"Bench Press","_id":"589f38f7c1fbcb16052a6952"},{"weight":155,"repetitions":10,"oneRepMax":206,"exercise":"Bench Press","_id":"589f38f7c1fbcb16052a6951"},{"weight":155,"repetitions":9,"oneRepMax":201,"exercise":"Bench Press","_id":"589f38f7c1fbcb16052a6950"}]},{"date":"2017-02-11T16:23:21.303Z","_id":"589f3a79b17af816f5cc8023","dataHistory":[{"weight":155,"repetitions":10,"oneRepMax":206,"exercise":"Bench Press","_id":"589f3a79b17af816f5cc8025"},{"weight":160,"repetitions":10,"oneRepMax":213,"exercise":"Bench Press","_id":"589f3a79b17af816f5cc8024"}]},{"date":"2017-02-11T16:38:56.177Z","_id":"589f3e20c665041904fa2eb4","dataHistory":[{"weight":160,"repetitions":10,"oneRepMax":213,"exercise":"Bench Press","_id":"589f3e20c665041904fa2eb7"},{"weight":160,"repetitions":10,"oneRepMax":213,"exercise":"Bench Press","_id":"589f3e20c665041904fa2eb6"},{"weight":160,"repetitions":9,"oneRepMax":207,"exercise":"Bench Press","_id":"589f3e20c665041904fa2eb5"}]},{"date":"2017-02-11T16:48:53.340Z","_id":"589f4075378f8f1c13fe88cf","dataHistory":[{"weight":290,"repetitions":12,"oneRepMax":414,"exercise":"Bench Press","_id":"589f4075378f8f1c13fe88d0"}]},{"date":"2017-02-11T16:58:27.658Z","_id":"589f42b37f922f1d90f9941a","dataHistory":[{"weight":123,"repetitions":124,"exercise":"Bench Press","_id":"589f42b37f922f1d90f9941b"}]},{"date":"2017-02-11T17:24:26.946Z","_id":"589f48ca7f922f1d90f99428","dataHistory":[{"weight":160,"repetitions":12,"oneRepMax":228,"exercise":"Bench Press","_id":"589f48ca7f922f1d90f9942b"},{"weight":160,"repetitions":12,"oneRepMax":228,"exercise":"Bench Press","_id":"589f48ca7f922f1d90f9942a"},{"weight":160,"repetitions":10,"oneRepMax":213,"exercise":"Bench Press","_id":"589f48ca7f922f1d90f99429"}]},{"date":"2017-02-13T17:17:28.484Z","_id":"58a1ea28a9d2f11800787465","dataHistory":[{"weight":35,"repetitions":10,"oneRepMax":46,"exercise":"Bench Press","_id":"58a1ea28a9d2f11800787467"},{"weight":36,"repetitions":12,"oneRepMax":51,"exercise":"Bench Press","_id":"58a1ea28a9d2f11800787466"}]}],"sets":[]},{"_id":"589f37ad251cc61588c4d952","name":"Incline Dumbbell Press","description":"","creator":"589f3792251cc61588c4d950","__v":0,"exerciseHistory":[{"date":"2017-02-11T16:16:55.837Z","_id":"589f38f7c1fbcb16052a6955","dataHistory":[{"weight":50,"repetitions":10,"oneRepMax":66,"exercise":"Incline Dumbbell Press","_id":"589f38f7c1fbcb16052a6958"},{"weight":50,"repetitions":10,"oneRepMax":66,"exercise":"Incline Dumbbell Press","_id":"589f38f7c1fbcb16052a6957"},{"weight":50,"repetitions":10,"oneRepMax":66,"exercise":"Incline Dumbbell Press","_id":"589f38f7c1fbcb16052a6956"}]},{"date":"2017-02-11T16:23:21.315Z","_id":"589f3a79b17af816f5cc8027","dataHistory":[{"weight":55,"repetitions":12,"oneRepMax":78,"exercise":"Incline Dumbbell Press","_id":"589f3a79b17af816f5cc8028"}]},{"date":"2017-02-11T16:38:56.193Z","_id":"589f3e20c665041904fa2eba","dataHistory":[{"weight":55,"repetitions":12,"oneRepMax":78,"exercise":"Incline Dumbbell Press","_id":"589f3e20c665041904fa2ebc"},{"weight":55,"repetitions":12,"oneRepMax":78,"exercise":"Incline Dumbbell Press","_id":"589f3e20c665041904fa2ebb"}]},{"date":"2017-02-11T17:24:26.959Z","_id":"589f48ca7f922f1d90f9942f","dataHistory":[{"weight":60,"repetitions":12,"oneRepMax":85,"exercise":"Incline Dumbbell Press","_id":"589f48ca7f922f1d90f99432"},{"weight":60,"repetitions":12,"oneRepMax":85,"exercise":"Incline Dumbbell Press","_id":"589f48ca7f922f1d90f99431"},{"weight":60,"repetitions":12,"oneRepMax":85,"exercise":"Incline Dumbbell Press","_id":"589f48ca7f922f1d90f99430"}]}],"sets":[]},{"_id":"589f37b6251cc61588c4d953","name":"Chest Fly (Machine)","description":"","creator":"589f3792251cc61588c4d950","__v":0,"exerciseHistory":[{"date":"2017-02-11T16:16:55.857Z","_id":"589f38f7c1fbcb16052a695c","dataHistory":[{"weight":120,"repetitions":12,"oneRepMax":171,"exercise":"Chest Fly (Machine)","_id":"589f38f7c1fbcb16052a695f"},{"weight":120,"repetitions":12,"oneRepMax":171,"exercise":"Chest Fly (Machine)","_id":"589f38f7c1fbcb16052a695e"},{"weight":120,"repetitions":12,"oneRepMax":171,"exercise":"Chest Fly (Machine)","_id":"589f38f7c1fbcb16052a695d"}]},{"date":"2017-02-11T16:38:56.220Z","_id":"589f3e20c665041904fa2ec0","dataHistory":[{"weight":125,"repetitions":12,"oneRepMax":178,"exercise":"Chest Fly (Machine)","_id":"589f3e20c665041904fa2ec3"},{"weight":155,"repetitions":12,"oneRepMax":221,"exercise":"Chest Fly (Machine)","_id":"589f3e20c665041904fa2ec2"},{"weight":155,"repetitions":12,"oneRepMax":221,"exercise":"Chest Fly (Machine)","_id":"589f3e20c665041904fa2ec1"}]},{"date":"2017-02-11T17:24:26.988Z","_id":"589f48ca7f922f1d90f99435","dataHistory":[{"weight":120,"repetitions":15,"exercise":"Chest Fly (Machine)","_id":"589f48ca7f922f1d90f99437"},{"weight":120,"repetitions":14,"exercise":"Chest Fly (Machine)","_id":"589f48ca7f922f1d90f99436"}]}],"sets":[]},{"_id":"589fa43e8a47ef0ca0ea92aa","name":"Bicep Curl","description":"Curl","category":"Arms","creator":"589f3792251cc61588c4d950","__v":0,"exerciseHistory":[],"sets":[]},{"_id":"58a084e56af5c40cbf2d7af4","name":"Crunch","description":"","category":"Core","creator":"589f3792251cc61588c4d950","__v":0,"exerciseHistory":[],"sets":[]}]
var jsonWorkouts = [{"_id":"589f48ca7f922f1d90f99424","date":"2017-02-11T17:24:26.927Z","creator":"589f3792251cc61588c4d950","__v":0,"sets":[{"weight":160,"repetitions":12,"oneRepMax":228,"exercise":"Bench Press","_id":"589f48ca7f922f1d90f99425"},{"weight":160,"repetitions":12,"oneRepMax":228,"exercise":"Bench Press","_id":"589f48ca7f922f1d90f99426"},{"weight":160,"repetitions":10,"oneRepMax":213,"exercise":"Bench Press","_id":"589f48ca7f922f1d90f99427"},{"weight":60,"repetitions":12,"oneRepMax":85,"exercise":"Incline Dumbbell Press","_id":"589f48ca7f922f1d90f9942c"},{"weight":60,"repetitions":12,"oneRepMax":85,"exercise":"Incline Dumbbell Press","_id":"589f48ca7f922f1d90f9942d"},{"weight":60,"repetitions":12,"oneRepMax":85,"exercise":"Incline Dumbbell Press","_id":"589f48ca7f922f1d90f9942e"},{"weight":120,"repetitions":15,"exercise":"Chest Fly (Machine)","_id":"589f48ca7f922f1d90f99433"},{"weight":120,"repetitions":14,"exercise":"Chest Fly (Machine)","_id":"589f48ca7f922f1d90f99434"}],"exercises":["589f37a1251cc61588c4d951","589f37ad251cc61588c4d952","589f37b6251cc61588c4d953"]},{"_id":"58a1ea28a9d2f11800787462","date":"2017-02-13T17:17:28.435Z","creator":"589f3792251cc61588c4d950","__v":0,"sets":[{"weight":35,"repetitions":10,"oneRepMax":46,"exercise":"Bench Press","_id":"58a1ea28a9d2f11800787463"},{"weight":36,"repetitions":12,"oneRepMax":51,"exercise":"Bench Press","_id":"58a1ea28a9d2f11800787464"}],"exercises":["589f37a1251cc61588c4d951"]}]
var jsonPrograms = [{"_id":"58a08929fad60b114250cff9","name":"chest","description":"","creator":"589f3792251cc61588c4d950","__v":0,"exercises":["589f37a1251cc61588c4d951","589f37ad251cc61588c4d952"]},{"_id":"58a0980629bf741a75530681","name":"Test","description":"lll","creator":"589f3792251cc61588c4d950","__v":0,"exercises":["589f37a1251cc61588c4d951","589f37ad251cc61588c4d952"]}]

// makes an ajax request for a user's exercises, programs, or workouts
// then displays it on the DOM in the appropriate location
function _DEV_getUserAssets(data, delimeter, type) {
  let reqType = type;

  _DEV_handleSpecificResponseType(data, reqType)
  .then(identifiedData => {
    _DEV_displayResponse(identifiedData.data, identifiedData.type);

  }, err => {
    console.log('Error in function "handleSpecficResponseType()"');
  });
}

// determines whether the response was an exercise or a program or a workout
// then assigns a type to it for further processing
function _DEV_handleSpecificResponseType(json, reqType) {
  return new Promise((resolve, reject) => {

    // check if data exists by sampling json data
    let sample = json[0];

    // initialize empty response object
    let response = {};

    // call function to display data based on type
    switch (reqType) {
      case 'exercises':
        response.type = 'exercises';
        console.log(`Type assigned: ${response.type}`);
        break;

      case 'workouts':
        response.type = 'workouts';
        console.log(`Type assigned: ${response.type}`);
        break;

      case 'programs':
        response.type = 'programs';
        console.log(`Type assigned: ${response.type}`);
        break;
    }

    // determined whether data is existant
    console.log('Assigning response.data')
    console.log('current value: ' + sample);
    console.log('value undefined? ' + sample === undefined)
    console.log('loose test: ' + sample == undefined)
    if (sample === undefined) {
      response.data = undefined;
      console.log(`Assigned data: ${response.data}`);
    } else {
      response.data = json;
      console.log(`Assigned data: ${response.data}`);
    }

    console.log('Resolving promise with object: ')
    console.log(response);
    resolve(response);
  });
}

// writes the reponse to the DOM based on what type of data is received
function _DEV_displayResponse(response, typeOfData) {
  // Hide the loading animation
  let loadingFields = document.getElementsByClassName('loading');
  for (let i = 0; i < loadingFields.length; i++) {
    loadingFields[i].classList.add('hidden');
  }

  // initialize HTML which is a part of every DOM addition
  let appendTo;
  let ul = document.createElement('ul');
  ul.classList.add('list-group');

  console.log('parsing response')
  console.log(response)
  console.log(typeOfData)
  console.log(response != undefined)
  console.log(response !== undefined)
  console.log(response == undefined)
  console.log(response === undefined)

  // create HTML for every json object, concatenate
  if (typeOfData == 'exercises' && response !== undefined) {
    appendTo = document.getElementById('exercises');
    ul.innerHTML = _DEV_displayExercise(response);

  } else if (typeOfData == 'workouts' && response !== undefined) {
    appendTo = document.getElementById('workouts');
    ul.innerHTML = _DEV_displayWorkout(response);

  } else if (typeOfData == 'programs' && response !== undefined) {
    appendTo = document.getElementById('programs');
    ul.innerHTML = _DEV_displayProgram(response);

  // displays the HTML for when no data is present
  } else if (typeOfData == 'exercises' && response === undefined) {
    appendTo = document.getElementById('exercises');
    ul.innerHTML = _DEV_displayNodataExercise();

  } else if (typeOfData == 'workouts' && response === undefined) {
    appendTo = document.getElementById('workouts');
    ul.innerHTML = _DEV_displayNodataWorkout();

  } else if (typeOfData == 'programs' && response === undefined) {
    appendTo = document.getElementById('programs');
    ul.innerHTML = _DEV_displayNodataProgram();

  // Something bad happened
  } else {
    alert(":(");
  }

  // Apply result to the DOM
  appendTo.appendChild(ul);
}

// functions to perform display operations based on datatype
function _DEV_displayExercise(response) {
  return response.map(exercise => {
    return `<li class="list-group-item">
              <a href="/exercise/detail/${exercise._id}">${exercise.name}</a>
              <form method="post" action="/exercise/delete/${exercise._id}">
                <button class="btn btn-danger" type="submit">Delete</button>
              </form>
              <form method="get" action="/exercise/edit/${exercise._id}">
                <button class="btn btn-warning right-buffer" type="submit">Edit</button>
              </form>
            </li>`
  }).join('');
}

function _DEV_displayWorkout(response) {
  return response.map(workout => {
    let localDate = new Date(workout.date).toLocaleString();
    return `<li class="list-group-item">
              <a href="/workout/detail/${workout._id}">${localDate}</a>
              <form method="post" action="/workout/delete/${workout._id}">
                <button class="btn btn-danger" type="submit">Delete</button>
              </form>
            </li>`
  }).join('');
}

function _DEV_displayProgram(response) {
  return response.map(program => {
    return `<li class="list-group-item">
              <a href="/program/detail/${program._id}">${program.name}</a>
              <!--
              <form method="get" action="/program/edit/${program._id}">
                <button class="btn btn-warning" type="submit">Edit</button>
              </form>
              <form method="post" action="/program/delete/${program._id}">
                <button class="btn btn-danger" type="submit">Delete</button>
              </form>
              -->
            </li>`
  }).join('');
}

function _DEV_displayNodataExercise() {
  return `<li class="list-group-item text-center">
            Add exercises to your account so you can add them to programs, log them in your workouts, and track your progress!
          </li>`;
}

function _DEV_displayNodataWorkout() {
  return `<li class="list-group-item text-center">
            You don't have any workouts logged yet! Add exercises so you can include them in logged workouts. Workouts can be free-form or follow a pre-defined program. Track your workouts so can start recording progress!
          </li>`;
}

function _DEV_displayNodataProgram() {
  return `<li class="list-group-item text-center">
            Have a few workouts that are "set-in-stone"? Input a your workout program so you can use it as a template while logging sets!
          </li>`;
}

// simulate loading
setTimeout(function() {
  _DEV_getUserAssets(jsonExercises, null, 'exercises');
}, 439);
setTimeout(function() {
  _DEV_getUserAssets(jsonWorkouts, null, 'workouts');
}, 768);
setTimeout(function() {
  _DEV_getUserAssets(jsonPrograms, null, 'programs');
}, 587);
